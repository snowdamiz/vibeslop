# Codebase Structure

**Analysis Date:** 2026-02-02

## Directory Layout

```
vibeslop/
├── backend/                    # Phoenix/Elixir REST API
│   ├── lib/
│   │   ├── backend/           # Domain contexts and schemas
│   │   │   ├── accounts/      # User and OAuth management
│   │   │   ├── ai/            # AI service integrations (OpenRouter, moderation)
│   │   │   ├── auth/          # JWT token generation and validation
│   │   │   ├── catalog/       # AI tools and tech stacks catalog
│   │   │   ├── content/       # Posts, projects, comments
│   │   │   ├── gigs/          # Freelance gigs, bids, reviews
│   │   │   ├── github/        # GitHub API client
│   │   │   ├── messaging/     # Conversations and messages
│   │   │   ├── social/        # Likes, reposts, follows, notifications, bookmarks
│   │   │   ├── workers/       # Oban background jobs
│   │   │   ├── accounts.ex    # Accounts context (public API)
│   │   │   ├── catalog.ex     # Catalog context
│   │   │   ├── content.ex     # Content context
│   │   │   ├── developer_score.ex # Developer scoring logic
│   │   │   ├── feed.ex        # Feed generation with algorithmic ranking
│   │   │   ├── gigs.ex        # Gigs context
│   │   │   ├── metrics.ex     # Analytics and metrics
│   │   │   ├── mentions.ex    # Mention detection and handling
│   │   │   ├── messaging.ex   # Messaging context
│   │   │   ├── recommendations.ex # Content recommendations
│   │   │   ├── search.ex      # Full-text search
│   │   │   ├── social.ex      # Social context
│   │   │   └── application.ex # OTP app startup and supervision
│   │   └── backend_web/       # HTTP layer
│   │       ├── controllers/   # HTTP request handlers (one per resource type)
│   │       ├── plugs/         # Middleware (auth, optional_auth)
│   │       ├── endpoint.ex    # Plug pipeline configuration
│   │       ├── router.ex      # Route definitions and scopes
│   │       └── telemetry.ex   # Metrics and observability
│   ├── config/                # Configuration files (dev.exs, prod.exs, test.exs)
│   ├── priv/
│   │   ├── repo/migrations/   # Ecto database migrations
│   │   ├── static/            # Static assets (if any)
│   │   └── gettext/           # Internationalization files
│   ├── test/                  # Test files
│   ├── mix.exs               # Mix project definition and deps
│   └── mix.lock              # Dependency lock file
│
├── frontend/                   # React + TypeScript frontend
│   ├── src/
│   │   ├── pages/            # Full-page components (Home, ProjectDetail, Gigs, etc.)
│   │   ├── components/       # Reusable components organized by domain
│   │   │   ├── ui/           # Headless UI primitives (button, card, dialog, etc.)
│   │   │   ├── feed/         # Feed, post, compose components
│   │   │   ├── gigs/         # Gig listing, detail, bid components
│   │   │   ├── comments/     # Comment thread and individual comment
│   │   │   ├── messages/     # Conversation and message components
│   │   │   ├── search/       # Search box and results
│   │   │   ├── layout/       # AppShell, Header, Sidebars, Footer
│   │   │   ├── ai/           # AI generation dialogs
│   │   │   ├── landing/      # Landing page sections
│   │   │   ├── icons/        # Custom SVG icons
│   │   │   └── seo/          # SEO meta tags and structured data
│   │   ├── context/          # React Context providers (Auth, Theme, Compose)
│   │   ├── hooks/            # Custom React hooks (useImpressionTracker, useSEO, etc.)
│   │   ├── lib/              # Utilities and API client
│   │   │   ├── api.ts        # HTTP client with type definitions
│   │   │   ├── utils.ts      # Helper functions (cn for classname merge)
│   │   │   └── fingerprint.ts # Device fingerprinting for tracking
│   │   ├── assets/           # Images, fonts, other static assets
│   │   ├── App.tsx           # Root router and layout switcher
│   │   ├── main.tsx          # Entry point (React root mount)
│   │   └── index.css         # Global Tailwind styles
│   ├── public/               # Served static files (favicon, robots.txt)
│   ├── dist/                 # Build output (generated by Vite)
│   ├── package.json          # npm dependencies and scripts
│   ├── vite.config.ts        # Vite build and dev server config
│   ├── tsconfig.json         # TypeScript compiler config
│   └── index.html            # HTML template
│
├── docs/                      # Documentation
├── docker-compose.yml         # Postgres dev environment
├── package.json              # Root monorepo scripts
└── README.md                 # Project overview
```

## Directory Purposes

**backend/lib/backend/**
- Purpose: Domain-driven context modules encapsulating all business logic and database operations
- Contains: Public API functions, Ecto queries, business rule enforcement
- Key files: accounts.ex, content.ex, social.ex, feed.ex, gigs.ex, search.ex

**backend/lib/backend_web/**
- Purpose: HTTP request/response handling and routing
- Contains: Controllers (request handlers), plugs (middleware), router (route definitions)
- Entry point: endpoint.ex configures Phoenix server; router.ex dispatches to controllers

**backend/priv/repo/migrations/**
- Purpose: Database schema version history
- Contains: Ecto migration files (incrementally numbered .exs files)
- Pattern: Each migration is a module defining up/0 and down/0 for schema changes

**frontend/src/pages/**
- Purpose: Full-page components for each route
- Contains: Home, ProjectDetail, PostDetail, UserProfile, Gigs, Admin, Auth pages, etc.
- Pattern: One `.tsx` file per route; imports domain-specific components

**frontend/src/components/ui/**
- Purpose: Headless UI primitives from Radix UI wrapped with Tailwind styling
- Contains: button, card, dialog, tabs, avatar, input, textarea, etc.
- Pattern: Shadcn-style wrapper components with consistent API

**frontend/src/components/feed/**
- Purpose: Feed rendering, post composition, and social interaction
- Contains: Feed (list), Post (item), ComposeBox, GlobalComposeDialog, ProjectComposer, QuotedPostPreview
- Key file: GlobalComposeDialog.tsx (large component managing compose state, media upload, AI generation)

**frontend/src/context/**
- Purpose: Global state management via React Context
- Contains: AuthContext (user, login state), ThemeContext (dark/light), ComposeContext (dialog/quoted item)
- Pattern: Provider wraps app in main.tsx; custom hooks expose state

**frontend/src/lib/**
- Purpose: Shared utilities and API communication
- Files: api.ts (centralized HTTP client with type definitions), utils.ts (classname merge), fingerprint.ts (device tracking)

**frontend/src/hooks/**
- Purpose: Reusable React hooks for common patterns
- Files: useImpressionTracker (track post views), useSEO (update meta tags), useSearchHistory (persist searches), useDebounce, useDebouncedSearch

## Key File Locations

**Entry Points:**

- `frontend/src/main.tsx`: React root mount, wraps with providers (BrowserRouter, ThemeProvider, AuthProvider)
- `frontend/src/App.tsx`: Router and layout logic (determines auth vs. landing vs. app shell based on auth state)
- `backend/lib/backend/application.ex`: OTP app startup, supervisor with Repo, PubSub, Oban, Endpoint children
- `backend/lib/backend_web/router.ex`: HTTP route definitions, organizes routes by auth requirement

**Configuration:**

- `frontend/vite.config.ts`: Vite build config, path alias `@` = src, dev server proxy to `http://localhost:4001/api`
- `frontend/tsconfig.json`: TypeScript compiler options
- `frontend/package.json`: npm scripts (dev, build, lint), dependencies (React, Radix, Tailwind, etc.)
- `backend/mix.exs`: Elixir/Phoenix project definition, dependencies, aliases for common tasks
- `backend/config/config.exs`: Shared config (logging, generators); dev.exs, test.exs, prod.exs override per environment

**Core Logic:**

- `backend/lib/backend/content.ex`: Posts, projects, comments CRUD and queries (list_feed_posts, create_post, etc.)
- `backend/lib/backend/feed.ex`: Algorithmic feed ranking (for_you_feed with engagement scoring + time decay)
- `backend/lib/backend/social.ex`: Likes, reposts, follows, notifications, bookmarks operations
- `backend/lib/backend/gigs.ex`: Gigs CRUD, bidding, hiring, reviews
- `backend/lib/backend/search.ex`: Full-text search for posts, projects, users
- `frontend/src/lib/api.ts`: HTTP client with method for each endpoint, type definitions for all models

**Testing:**

- `backend/test/backend/`: Unit tests for contexts
- `backend/test/backend_web/`: Integration tests for controllers
- `backend/test/support/`: Test fixtures and helpers
- `frontend/src/`: No dedicated test directory (would be `*.test.tsx` or `*.spec.tsx` in same directories)

## Naming Conventions

**Files:**

- **Frontend Components:** PascalCase, `.tsx` for React components, `.ts` for pure TypeScript
  - Examples: `Feed.tsx`, `Post.tsx`, `UserProfile.tsx`, `api.ts`
- **Frontend Pages:** PascalCase, `src/pages/` directory
  - Examples: `Home.tsx`, `ProjectDetail.tsx`, `GigDetail.tsx`
- **Frontend Contexts:** PascalCase with Context suffix, `src/context/` directory
  - Examples: `AuthContext.tsx`, `ThemeContext.tsx`
- **Frontend Hooks:** camelCase with use prefix, `src/hooks/` directory
  - Examples: `useImpressionTracker.ts`, `useSEO.ts`
- **Backend Modules:** snake_case, `.ex` extension
  - Examples: `accounts.ex`, `post_controller.ex`, `developer_score_worker.ex`
- **Backend Schemas:** PascalCase, nested under context subdirectory
  - Examples: `lib/backend/accounts/user.ex`, `lib/backend/content/post.ex`
- **Migrations:** Timestamp prefix + description, `.exs` extension
  - Examples: `20260119000001_create_users.exs`, `20260120000004_add_impression_count_to_posts.exs`

**Directories:**

- **Frontend domains:** Lowercase, descriptive plural or singular names
  - Examples: `feed/`, `gigs/`, `comments/`, `messages/`, `search/`
- **Backend domains (contexts):** Lowercase, plural when representing collections
  - Examples: `accounts/`, `content/`, `social/`, `gigs/`, `messaging/`
- **Shared:** Conventional names: `lib/`, `config/`, `priv/`, `test/`, `public/`, `dist/`

## Where to Add New Code

**New Page/Feature (Frontend):**
1. Create page component: `src/pages/NewFeatureName.tsx`
2. Import components from appropriate domain: `src/components/domain/ComponentName.tsx`
3. Use API client: `import { api } from '@/lib/api'` then `api.methodName()`
4. Add route in `src/App.tsx`: `<Route path="/new-feature" element={<NewFeatureName />} />`

**New Component (Frontend):**
1. Create in appropriate domain directory: `src/components/domain/ComponentName.tsx`
2. If reusable UI primitive, place in: `src/components/ui/ComponentName.tsx`
3. Export from domain index file: `src/components/domain/index.ts`
4. Import in page: `import { ComponentName } from '@/components/domain'`

**New API Endpoint (Frontend Client):**
1. Add method to `src/lib/api.ts`:
   ```typescript
   export async function newEndpoint(params: Type): Promise<ResponseType> {
     return request(`/endpoint`, { method: 'POST', body: params })
   }
   ```
2. Add type definitions near top of file in interface section
3. Call from component/context via `import { api } from '@/lib/api'` then `api.newEndpoint(data)`

**New Context (Frontend):**
1. Create provider: `src/context/NewContext.tsx`
2. Export Provider and useContext hook
3. Wrap app in `src/main.tsx`: add to providers list
4. Use in components: `const state = useNewContext()`

**New Domain Context (Backend):**
1. Create context module: `lib/backend/new_domain.ex`
2. Import Ecto.Query and Repo
3. Define public API functions that return {:ok, data} or {:error, reason}
4. Create associated schema: `lib/backend/new_domain/entity.ex`
5. Add migrations: `priv/repo/migrations/TIMESTAMP_create_entities.exs`
6. Call from controller: `alias Backend.NewDomain` then `NewDomain.operation(params)`

**New Controller (Backend):**
1. Create `lib/backend_web/controllers/resource_controller.ex`
2. Use `BackendWeb` mixin and set action_fallback
3. Define action functions: `def index(conn, params)`, `def create(conn, params)`, etc.
4. Call context: `Backend.Context.operation(params)`
5. Render JSON: `render(conn, :index, items: items)`
6. Add route in `lib/backend_web/router.ex`: `post "/resources", ResourceController, :create`

**New JSON View (Backend):**
1. Create `lib/backend_web/controllers/resource_json.ex` (handles response formatting)
2. Define public functions: `def index(%{items: items})`, etc.
3. Transform Ecto structs to JSON-serializable maps
4. Controller calls: `render(conn, :index, items: items)` → loads resource_json.ex automatically

**Utility Functions (Frontend):**
- General helpers: `src/lib/utils.ts`
- Hooks: `src/hooks/useHookName.ts`
- Custom business logic: Create new file in relevant domain or lib subdirectory

**Utility Functions (Backend):**
- Domain-specific: Within the context module (e.g., `Backend.Content.get_post/1`)
- Cross-cutting: In separate module if used by multiple contexts (e.g., `Backend.Mentions`)

## Special Directories

**frontend/public/:**
- Purpose: Static files served at root path (favicon, robots.txt, manifest.json)
- Generated: No
- Committed: Yes

**frontend/dist/:**
- Purpose: Production build output from Vite
- Generated: Yes (created by `npm run build`)
- Committed: No (in .gitignore)

**backend/_build/:**
- Purpose: Compiled Elixir output and build artifacts
- Generated: Yes (created by mix compile)
- Committed: No (in .gitignore)

**backend/deps/:**
- Purpose: Downloaded Elixir dependencies from Hex
- Generated: Yes (created by `mix deps.get`)
- Committed: No (in .gitignore)

**frontend/node_modules/:**
- Purpose: Downloaded npm packages
- Generated: Yes (created by npm install)
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-02-02*
